

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="周周">
  <meta name="keywords" content="">
  
    <meta name="description" content="Dockerfile的组成构建docker镜像的文件，命令+参数+脚本 步骤  编写一个dockerfile文件 docker build 构建成一个镜像 docker run运行镜像 docker push发布镜像至DockerHub或阿里云镜像仓库  官方做法：在dockerHub中随意点击一个镜像的版本，就会跳转至github的DockerFile目录，如cengtos7显示如下： 12">
<meta property="og:type" content="article">
<meta property="og:title" content="Docker进阶-Dockerfile-镜像构建发布">
<meta property="og:url" content="http://example.com/2022/08/06/Docker%E8%BF%9B%E9%98%B6-Dockerfile-%E9%95%9C%E5%83%8F%E6%9E%84%E5%BB%BA%E5%8F%91%E5%B8%83/index.html">
<meta property="og:site_name" content="周周的地盘">
<meta property="og:description" content="Dockerfile的组成构建docker镜像的文件，命令+参数+脚本 步骤  编写一个dockerfile文件 docker build 构建成一个镜像 docker run运行镜像 docker push发布镜像至DockerHub或阿里云镜像仓库  官方做法：在dockerHub中随意点击一个镜像的版本，就会跳转至github的DockerFile目录，如cengtos7显示如下： 12">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://raw.githubusercontent.com/YuanZhou314/PicRepo/main/imgs/20220806200522.png">
<meta property="og:image" content="https://raw.githubusercontent.com/YuanZhou314/PicRepo/main/imgs/20220806200538.png">
<meta property="og:image" content="https://raw.githubusercontent.com/YuanZhou314/PicRepo/main/imgs/20220806200655.png">
<meta property="og:image" content="https://raw.githubusercontent.com/YuanZhou314/PicRepo/main/imgs/20220806200708.png">
<meta property="og:image" content="https://raw.githubusercontent.com/YuanZhou314/PicRepo/main/imgs/20220806200810.png">
<meta property="og:image" content="https://raw.githubusercontent.com/YuanZhou314/PicRepo/main/imgs/20220806201034.png">
<meta property="og:image" content="https://raw.githubusercontent.com/YuanZhou314/PicRepo/main/imgs/20220806201046.png">
<meta property="og:image" content="https://raw.githubusercontent.com/YuanZhou314/PicRepo/main/imgs/20220806201101.png">
<meta property="og:image" content="https://raw.githubusercontent.com/YuanZhou314/PicRepo/main/imgs/20220806201113.png">
<meta property="og:image" content="https://raw.githubusercontent.com/YuanZhou314/PicRepo/main/imgs/20220806201143.png">
<meta property="og:image" content="https://raw.githubusercontent.com/YuanZhou314/PicRepo/main/imgs/20220806201204.png">
<meta property="article:published_time" content="2022-08-06T12:04:28.000Z">
<meta property="article:modified_time" content="2022-08-06T12:12:25.039Z">
<meta property="article:author" content="周周">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://raw.githubusercontent.com/YuanZhou314/PicRepo/main/imgs/20220806200522.png">
  
  
  
  <title>Docker进阶-Dockerfile-镜像构建发布 - 周周的地盘</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.2","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"OTIyisgVldQtTwVk1kC3xG75-gzGzoHsz","app_key":"7oB3ndT9XSQ2jtgBMxNhwe9W","path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 5.4.2"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>周周的地盘</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Docker进阶-Dockerfile-镜像构建发布"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2022-08-06 20:04" pubdate>
          2022年8月6日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          8.1k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          68 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">Docker进阶-Dockerfile-镜像构建发布</h1>
            
            
              <div class="markdown-body">
                
                <span id="more"></span>

<h2 id="Dockerfile的组成"><a href="#Dockerfile的组成" class="headerlink" title="Dockerfile的组成"></a>Dockerfile的组成</h2><p>构建docker镜像的文件，命令+参数+脚本</p>
<p>步骤</p>
<ol>
<li>编写一个dockerfile文件</li>
<li>docker build 构建成一个镜像</li>
<li>docker run运行镜像</li>
<li>docker push发布镜像至DockerHub或阿里云镜像仓库</li>
</ol>
<p>官方做法：在dockerHub中随意点击一个镜像的版本，就会跳转至github的DockerFile目录，如cengtos7显示如下：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs stylus">FROM scratch <br> <br> <br>ADD centos-<span class="hljs-number">7</span>-x86_64-docker<span class="hljs-selector-class">.tar</span><span class="hljs-selector-class">.xz</span> /<br> <br>LABEL \<br> <br>org<span class="hljs-selector-class">.label-schema</span>.schema-version=<span class="hljs-string">&quot;1.0&quot;</span> \<br> <br>org<span class="hljs-selector-class">.label-schema</span>.name=<span class="hljs-string">&quot;CentOS Base Image&quot;</span> \<br> <br>org<span class="hljs-selector-class">.label-schema</span>.vendor=<span class="hljs-string">&quot;CentOS&quot;</span> \<br> <br>org<span class="hljs-selector-class">.label-schema</span>.license=<span class="hljs-string">&quot;GPLv2&quot;</span> \<br> <br>org<span class="hljs-selector-class">.label-schema</span>.build-date=<span class="hljs-string">&quot;20201113&quot;</span> \<br> <br>org<span class="hljs-selector-class">.opencontainers</span><span class="hljs-selector-class">.image</span>.title=<span class="hljs-string">&quot;CentOS Base Image&quot;</span> \<br> <br>org<span class="hljs-selector-class">.opencontainers</span><span class="hljs-selector-class">.image</span>.vendor=<span class="hljs-string">&quot;CentOS&quot;</span> \<br> <br>org<span class="hljs-selector-class">.opencontainers</span><span class="hljs-selector-class">.image</span>.licenses=<span class="hljs-string">&quot;GPL-2.0-only&quot;</span> \<br> <br>org<span class="hljs-selector-class">.opencontainers</span><span class="hljs-selector-class">.image</span>.created=<span class="hljs-string">&quot;2020-11-13 00:00:00+00:00&quot;</span><br> <br> <br>CMD <span class="hljs-selector-attr">[<span class="hljs-string">&quot;/bin/bash&quot;</span>]</span><br></code></pre></td></tr></table></figure>

<p>官方的镜像一般是基础包，只要能跑起来即可，很多功能是没有的，所以一般都是自己搭建镜像（使用docker指令）</p>
<p>实际工作中，docker镜像甚至是交付的标准，项目做好之后必须打包成docker镜像来交付：</p>
<p>原则：</p>
<ul>
<li>指令是大写字母</li>
<li>执行顺序从上至下，每个指令都会创建提交一个新的镜像层</li>
</ul>
<p><img src="https://raw.githubusercontent.com/YuanZhou314/PicRepo/main/imgs/20220806200522.png" srcset="/img/loading.gif" lazyload></p>
<p>Dockerfile：构建文件，定义了一切的步骤，源代码</p>
<p>DockerImages：通过Dockerfile构建生成的镜像，最终发布和运行的产品</p>
<p>Docker容器：镜像运行起来提供服务器</p>
<h2 id="Docker指令"><a href="#Docker指令" class="headerlink" title="Docker指令"></a>Docker指令</h2><p><img src="https://raw.githubusercontent.com/YuanZhou314/PicRepo/main/imgs/20220806200538.png" srcset="/img/loading.gif" lazyload></p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span>           <span class="hljs-comment">#基础镜像，一切从这里开始构建</span><br><span class="hljs-keyword">MAINTAINER</span>     <span class="hljs-comment">#镜像的署名和联系方式</span><br><span class="hljs-keyword">RUN</span><span class="language-bash">            <span class="hljs-comment">#镜像构建时需要运行的命令</span></span><br><span class="hljs-keyword">ADD</span><span class="language-bash">            <span class="hljs-comment">#添加内容，源文件可以是相对路径，可以是url，特可以是tar.gz文件（会自动解压）</span></span><br><span class="hljs-keyword">WORKDIR</span><span class="language-bash">        <span class="hljs-comment">#镜像的工作目录</span></span><br><span class="hljs-keyword">VOLUME</span><span class="language-bash">         <span class="hljs-comment">#挂载的目录</span></span><br><span class="hljs-keyword">EXPOSE</span>         <span class="hljs-comment">#保留端口配置，开启后外部无需使用-p</span><br><span class="hljs-keyword">CMD</span><span class="language-bash">            <span class="hljs-comment">#指定这个容器启动的时候要运行的命令，只有最后一个会生效，可被替代</span></span><br><span class="hljs-keyword">ENTRYPOINT</span><span class="language-bash">     <span class="hljs-comment">#指定这个容器启动的时候要运行的命令，可以追加命令</span></span><br><span class="hljs-keyword">ONBUILD</span>        <span class="hljs-comment">#当构建一个被继承 DockerFile 这个时候就会运行ONBUILD的指令 ，触发指令</span><br><span class="hljs-keyword">COPY</span><span class="language-bash">           <span class="hljs-comment">#类似ADD，将文件拷贝至镜像中，格式：COPY 源目标 目的目标。多个命令使用&amp;&amp;拼接</span></span><br><span class="hljs-keyword">ENV</span>            <span class="hljs-comment">#构建的时候设置环境变量</span><br></code></pre></td></tr></table></figure>



<p><strong>备注：CMD与ENTRYPOINT的区别</strong></p>
<p>当一个镜像使用CMD指定容器启动后运行的命令时，只有最后一个会真实生效，并且当从外部启动时新增了额外的命令时，CMD的命令会被替代。如：构建镜像时使用了CMD [‘ls’, ‘-a’]，启动容器后会自动打印当前目录列表，但如果启动时额外加了参数 -l，这时的-l并不会和ls -a合并成新命令，而是替代ls -a作为新命令。但-l并非完整命令，所以当容器启动时就会报错</p>
<p><img src="https://raw.githubusercontent.com/YuanZhou314/PicRepo/main/imgs/20220806200655.png" srcset="/img/loading.gif" lazyload></p>
<p> 当一个镜像使用ENTRYPOINT指定容器启动后运行的命令时，在外部启动容器时可以追加命令，拿上面的例子说，如果构建时使用ENTRYPOINT [‘ls’, ‘-a’]，外部启动时额外加了-l，则这里的-l会和镜像自带的ls -a 合并成完整命令ls -al </p>
<p><img src="https://raw.githubusercontent.com/YuanZhou314/PicRepo/main/imgs/20220806200708.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="配置带vim-和ifconfig的CentOS"><a href="#配置带vim-和ifconfig的CentOS" class="headerlink" title="配置带vim 和ifconfig的CentOS"></a>配置带vim 和ifconfig的CentOS</h2><p>手动配置镜像，一般从scratch 开始（dockerhub中99%的镜像从这个基础镜像过来的）。手动配置之前，可以用<strong>docker history</strong>命令查看其他镜像的构建步骤：</p>
<p><img src="https://raw.githubusercontent.com/YuanZhou314/PicRepo/main/imgs/20220806200810.png" srcset="/img/loading.gif" lazyload></p>
<p> 编辑Dockerfie文件</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">[root@VM-<span class="hljs-number">0</span>-<span class="hljs-number">7</span>-centos dockerfile]<span class="hljs-comment"># vim centos-yz #这里的centos-yz如果写成Dockerfile，则编译时无需-f寻找编译文件，会自动寻找</span><br><span class="hljs-keyword">FROM</span> centos<br><span class="hljs-keyword">MAINTAINER</span> zhouyinlin&lt;<span class="hljs-number">1909423593</span>@qq.com&gt;<br><span class="hljs-keyword">ENV</span> MYPATH /root/<br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> <span class="hljs-variable">$MYPATH</span></span><br><span class="hljs-comment">#构建时运行的命令</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> yum -y install vim</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> yum -y install net-tools</span><br><span class="hljs-comment">#打开端口</span><br><span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">80</span><br><br><span class="hljs-keyword">CMD</span><span class="language-bash"> <span class="hljs-variable">$PATH</span></span><br><span class="hljs-keyword">CMD</span><span class="language-bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;------------------end-------------------&quot;</span></span><br><span class="hljs-keyword">CMD</span><span class="language-bash"> /bin/bash</span><br>[root@VM-<span class="hljs-number">0</span>-<span class="hljs-number">7</span>-centos dockerfile]<span class="hljs-comment"># docker build -f centos-yz -t centos-yz:1.0 . #开始构建</span><br></code></pre></td></tr></table></figure>

<p>构建后进入新的CentOS，发现vim和ifconfig都有了</p>
<figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs tap">[root@VM-0-7-centos dockerfile]<span class="hljs-comment"># docker images</span><br>REPOSITORY            TAG       IMAGE ID       CREATED          SIZE<br>centos-yz             1.0       a2f9e606e2c5  <span class="hljs-number"> 15 </span>seconds ago   322MB<br> <br>[root@VM-0-7-centos dockerfile]<span class="hljs-comment"># docker run -it centos-yz:1.0</span><br>[root@4103126b11ae ~]<span class="hljs-comment"># vim</span><br>[root@4103126b11ae ~]<span class="hljs-comment"># ifconfig</span><br>eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500<br>        inet 172.18.0.2  netmask 255.255.0.0  broadcast 172.18.255.255<br>        ether 02:42:ac:12:00:02  txqueuelen<span class="hljs-number"> 0 </span> (Ethernet)<br>        RX packets<span class="hljs-number"> 8 </span> bytes<span class="hljs-number"> 656 </span>(656.0 B)<br>        RX errors<span class="hljs-number"> 0 </span> dropped<span class="hljs-number"> 0 </span> overruns<span class="hljs-number"> 0 </span> frame 0<br>        TX packets<span class="hljs-number"> 0 </span> bytes<span class="hljs-number"> 0 </span>(0.0 B)<br>        TX errors<span class="hljs-number"> 0 </span> dropped<span class="hljs-number"> 0 </span>overruns<span class="hljs-number"> 0 </span> carrier<span class="hljs-number"> 0 </span> collisions 0<br> <br> <br>lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536<br>        inet 127.0.0.1  netmask 255.0.0.0<br>        loop  txqueuelen<span class="hljs-number"> 1000 </span> (Local Loopback)<br>        RX packets<span class="hljs-number"> 0 </span> bytes<span class="hljs-number"> 0 </span>(0.0 B)<br>        RX errors<span class="hljs-number"> 0 </span> dropped<span class="hljs-number"> 0 </span> overruns<span class="hljs-number"> 0 </span> frame 0<br>        TX packets<span class="hljs-number"> 0 </span> bytes<span class="hljs-number"> 0 </span>(0.0 B)<br>        TX errors<span class="hljs-number"> 0 </span> dropped<span class="hljs-number"> 0 </span>overruns<span class="hljs-number"> 0 </span> carrier<span class="hljs-number"> 0 </span> collisions 0<br> <br>[root@4103126b11ae ~]<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure>

<h2 id="配置自带Tomcat的镜像，且允许从外部部署项目"><a href="#配置自带Tomcat的镜像，且允许从外部部署项目" class="headerlink" title="配置自带Tomcat的镜像，且允许从外部部署项目"></a>配置自带Tomcat的镜像，且允许从外部部署项目</h2><p>编辑Dockerfile文件</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs awk">FROM centos<br>MAINTAINER ZHOUYINGLIN&lt;<span class="hljs-number">1909423593</span>@QQ.COM&gt;<br><br><br>COPY readme.txt <span class="hljs-regexp">/usr/</span>local/readme.txt <span class="hljs-comment">#阅读文档</span><br><br><span class="hljs-comment">#将压缩包和jdk添加到镜像</span><br>ADD apache-tomcat-<span class="hljs-number">9.0</span>.<span class="hljs-number">22</span>.tar.gz <span class="hljs-regexp">/usr/</span>local  <br>ADD jdk-<span class="hljs-number">8</span>u151-linux-x64.tar.gz <span class="hljs-regexp">/usr/</span>local<br><br><br>RUN yum -y install vim<br><br><span class="hljs-comment">#配置工作目录和路径</span><br>ENV MYPATH <span class="hljs-regexp">/usr/</span>local<br>WORKDIR <span class="hljs-variable">$MYPATH</span><br><br><span class="hljs-comment">#配置相关的环境变量</span><br>ENV JAVA_HOME <span class="hljs-regexp">/usr/</span>local/jdk1.<span class="hljs-number">8.0</span>_151<br>ENV CLASSPATH <span class="hljs-variable">$JAVA_HOME</span><span class="hljs-regexp">/lib/</span>dt.jar:<span class="hljs-variable">$JAVA_HOME</span><span class="hljs-regexp">/lib/</span>tools.jar<br>ENV CATALINA_HOME <span class="hljs-regexp">/usr/</span>local/apache-tomcat-<span class="hljs-number">9.0</span>.<span class="hljs-number">22</span><br>ENV CATALINA_BASH <span class="hljs-regexp">/usr/</span>local/apache-tomcat-<span class="hljs-number">9.0</span>.<span class="hljs-number">22</span><br>ENV PATH <span class="hljs-variable">$PATH</span>:<span class="hljs-variable">$JAVA_HOME</span><span class="hljs-regexp">/bin:$CATALINA_HOME/</span>lib:<span class="hljs-variable">$CATALINA_HOME</span>/bin<br><br><span class="hljs-comment">#开放端口</span><br>EXPOSE <span class="hljs-number">8080</span><br><br><span class="hljs-comment">#镜像运行时，就启动tomcat，并写入日志</span><br>CMD <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/apache-tomcat-9.0.22/</span>bin<span class="hljs-regexp">/startup.sh &amp;&amp; tail -F /u</span>sr<span class="hljs-regexp">/local/</span>apache-tomcat-<span class="hljs-number">9.0</span>.<span class="hljs-number">22</span><span class="hljs-regexp">/logs/</span>catalina.out<br></code></pre></td></tr></table></figure>

<p>构建镜像并启动容器</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk">docker build -tdiytomcat . <span class="hljs-comment">#这里由于dockerfile名叫：Dockerfile，因此无需再加-f 但注意后面的点，表示是当前目录的</span><br><br><span class="hljs-comment">#开放宿主机的9090端口映射至容器的8080端口，挂载两个目录：1.项目目录 2.日志存放目录</span><br><span class="hljs-comment">#宿主机的tomcat/project映射到webapps下的test目录，test项目下所有文件都可以从外部部署进去</span><br>docker run -d -p <span class="hljs-number">9090</span>:<span class="hljs-number">8080</span> --name newtomcat -v <span class="hljs-regexp">/root/</span>dockerfile<span class="hljs-regexp">/tomcat/</span>project:<span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/apache-tomcat-9.0.22/</span>webapps<span class="hljs-regexp">/test -v /</span>root<span class="hljs-regexp">/dockerfile/</span>tomcat<span class="hljs-regexp">/logs:/u</span>sr<span class="hljs-regexp">/local/</span>apache-tomcat-<span class="hljs-number">9.0</span>.<span class="hljs-number">22</span>/logs diytomcat<br></code></pre></td></tr></table></figure>

<p>目前为止，就可以正常的在宿主机或者外部网络访问到tomcat的主页啦。项目就弄一个简单的网页就好了，再以IP:port/项目名就可以访问项目主页了</p>
<p>新建项目</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">在宿主机的project下新建WEB<span class="hljs-literal">-INF</span>等目录、文件，层级如下：<br>project<br>    WEB<span class="hljs-literal">-INF</span>O<br>        web.<span class="hljs-keyword">xml</span><br>    <span class="hljs-title">index</span>.jsp<br></code></pre></td></tr></table></figure>

<p>文件描述</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml">web.xml<br><br><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">web-app</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://xmlns.jcp.org/xml/ns/javaee</span></span><br><span class="hljs-string"><span class="hljs-tag">                      http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">version</span>=<span class="hljs-string">&quot;4.0&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">metadata-complete</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">web-app</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p><strong>index.jsp</strong></p>
<p>&lt;%@ page language=”java” contentType=”text/html; charset=UTF-8”</p>
<p>  pageEncoding=”UTF-8”%&gt;</p>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<html>

<head>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>new tomcat</title>

</head>

<body>

<p>​    恭喜，web项目已经搭建完成。</p>
</body>

</html>

 

<h2 id="发布镜像至DockerHub"><a href="#发布镜像至DockerHub" class="headerlink" title="发布镜像至DockerHub"></a>发布镜像至DockerHub</h2><p>发布镜像到dockerHub上，首先要做的事应该是登录。如果没有登录过，那么需要先注册账号：<a target="_blank" rel="noopener" href="https://hub.docker.com/">https://hub.docker.com/</a> 。登录好之后才可以提交镜像，docker中的登录的帮助文档长这样：</p>
<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs vbnet">[root@VM-<span class="hljs-number">0</span>-<span class="hljs-number">7</span>-centos project]# docker login --help<br><br><br><span class="hljs-symbol">Usage:</span>  docker login [OPTIONS] [SERVER]<br><br><br>Log <span class="hljs-keyword">in</span> <span class="hljs-keyword">to</span> a Docker registry.<br><span class="hljs-keyword">If</span> no server <span class="hljs-built_in">is</span> specified, the <span class="hljs-keyword">default</span> <span class="hljs-built_in">is</span> defined <span class="hljs-keyword">by</span> the daemon.<br><br><br><span class="hljs-symbol">Options:</span><br>  -p, --password <span class="hljs-type">string</span>   Password<br>      --password-stdin    <span class="hljs-keyword">Take</span> the password <span class="hljs-keyword">from</span> stdin<br>  -u, --username <span class="hljs-type">string</span>   Username<br></code></pre></td></tr></table></figure>

<p>登录好之后，就可以使用docker push提交镜像</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yaml">[<span class="hljs-string">root@VM-0-7-centos</span> <span class="hljs-string">~</span>]<span class="hljs-comment"># docker push diytomcat</span><br><span class="hljs-attr">Using default tag:</span> <span class="hljs-string">latest</span><br><span class="hljs-string">The</span> <span class="hljs-string">push</span> <span class="hljs-string">refers</span> <span class="hljs-string">to</span> <span class="hljs-string">repository</span> [<span class="hljs-string">docker.io/library/diytomcat</span>]<br><span class="hljs-attr">ffb151e67a73:</span> <span class="hljs-string">Preparing</span><br><span class="hljs-attr">23127db07fa3:</span> <span class="hljs-string">Preparing</span><br><span class="hljs-attr">1e438b048a4f:</span> <span class="hljs-string">Preparing</span><br><span class="hljs-attr">328e77a13569:</span> <span class="hljs-string">Preparing</span><br><span class="hljs-attr">74ddd0ec08fa:</span> <span class="hljs-string">Preparing</span><br><span class="hljs-attr">denied:</span> <span class="hljs-string">requested</span> <span class="hljs-string">access</span> <span class="hljs-string">to</span> <span class="hljs-string">the</span> <span class="hljs-string">resource</span> <span class="hljs-string">is</span> <span class="hljs-string">denied</span>  <span class="hljs-comment">#提示拒绝</span><br></code></pre></td></tr></table></figure>

<p>这里有一个提示错误，因为是我们的push格式有错误。所以不会上去的。正确的命令格式应该是先将做好的镜像使用tag命令规范命名</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs crmsh"><span class="hljs-comment">#格式：用户名/镜像名:版本号。创建完后会出现一个一样的镜像</span><br>[root@VM-<span class="hljs-number">0</span>-<span class="hljs-number">7</span>-centos ~]<span class="hljs-comment"># docker tag diytomcat zhouyinglin/diytomcat:v1</span><br>[root@VM-<span class="hljs-number">0</span>-<span class="hljs-number">7</span>-centos ~]<span class="hljs-comment"># docker images</span><br>REPOSITORY              <span class="hljs-keyword">TAG</span>       <span class="hljs-title">IMAGE</span> ID       CREATED         SIZE<br>diytomcat               latest    <span class="hljs-number">50316</span>eed1aeb   <span class="hljs-number">5</span> hours ago     <span class="hljs-number">695M</span>B<br>zhouyinglin/diytomcat   v1        <span class="hljs-number">50316</span>eed1aeb   <span class="hljs-number">5</span> hours ago     <span class="hljs-number">695M</span>B<br></code></pre></td></tr></table></figure>

<p>接着我们就可以正常使用push命令了。云服务器的小水管虽然慢，但毕竟是阿里的网，也是能够上传完的，本地网络的话就有可能传不上去，毕竟DockerHub是国外的</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs livescript">[root@VM-0-7-centos ~]<span class="hljs-comment"># docker push zhouyinglin/diytomcat:v1</span><br>The push refers <span class="hljs-keyword">to</span> repository [docker.io/zhouyinglin/diytomcat]<br>ffb151e67a73: Pushing [=====================&gt;                             ]  <span class="hljs-number">26.99</span>MB/<span class="hljs-number">64</span>MB<br><span class="hljs-number">23127db</span>07fa3: Pushing [=&gt;                                                 ]  <span class="hljs-number">10.98</span>MB/<span class="hljs-number">384.4</span>MB<br><span class="hljs-number">1e</span>438b048a4f: Pushing [==================================================&gt;]  <span class="hljs-number">15.41</span>MB/<span class="hljs-number">15.41</span>MB<br><span class="hljs-number">328e</span>77a13569: Pushing [==================================================&gt;]  <span class="hljs-number">3.072k</span>B<br><span class="hljs-number">74ddd</span>0ec08fa: Pushing [=====&gt;                                             ]  <span class="hljs-number">23.48</span>MB/<span class="hljs-number">231.3</span>MB<br></code></pre></td></tr></table></figure>

<h2 id="发布镜像至阿里云镜像仓库"><a href="#发布镜像至阿里云镜像仓库" class="headerlink" title="发布镜像至阿里云镜像仓库"></a>发布镜像至阿里云镜像仓库</h2><p>登录阿里云仓库：<a target="_blank" rel="noopener" href="https://cr.console.aliyun.com/cn-hangzhou/instance/repositories">https://cr.console.aliyun.com/cn-hangzhou/instance/repositories</a></p>
<p>创建命名空间</p>
<p><img src="https://raw.githubusercontent.com/YuanZhou314/PicRepo/main/imgs/20220806201034.png" srcset="/img/loading.gif" lazyload></p>
<p>创建容器镜像</p>
<p><img src="https://raw.githubusercontent.com/YuanZhou314/PicRepo/main/imgs/20220806201046.png" srcset="/img/loading.gif" lazyload></p>
<p>查看仓库面板</p>
<p>仓库地址：</p>
<p><img src="https://raw.githubusercontent.com/YuanZhou314/PicRepo/main/imgs/20220806201101.png" srcset="/img/loading.gif" lazyload></p>
<p>官方push流程</p>
<p><img src="https://raw.githubusercontent.com/YuanZhou314/PicRepo/main/imgs/20220806201113.png" srcset="/img/loading.gif" lazyload></p>
<p>这里其实只要注意一个点就行了，就是需要将自己的镜像按照阿里云的操作流程，修改tag</p>
<p>在DockerHub中，tag一般修改成DockerHub用户名/镜像名:版本号</p>
<p>在阿里云中，tag要求修改成docker tag [ImageId] <a target="_blank" rel="noopener" href="http://registry.cn-hangzhou.aliyuncs.com/yz-zhouyinglin/resp">registry.cn-hangzhou.aliyuncs.com/yz-zhouyinglin/resp</a> : 版本号</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">[root@VM-<span class="hljs-number">0</span>-<span class="hljs-number">7</span>-centos ~]<span class="hljs-comment"># docker tag 50316eed1aeb registry.cn-hangzhou.aliyuncs.com/yz-zhouyinglin/resp:v1</span><br>[root@VM-<span class="hljs-number">0</span>-<span class="hljs-number">7</span>-centos ~]<span class="hljs-comment"># docker images</span><br>REPOSITORY                                              <span class="hljs-keyword">TAG</span>       <span class="hljs-title">IMAGE</span> ID       CREATED         SIZE<br>diytomcat                                               latest    <span class="hljs-number">50316</span>eed1aeb   <span class="hljs-number">6</span> hours ago     <span class="hljs-number">695M</span>B<br>registry.cn-hangzhou.aliyuncs.com/yz-zhouyinglin/resp   v1        <span class="hljs-number">50316</span>eed1aeb   <span class="hljs-number">6</span> hours ago     <span class="hljs-number">695M</span>B<br></code></pre></td></tr></table></figure>

<p>修改之后才可以进行push，当然也是速度很慢，毕竟是学生机小水管</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs livescript">[root@VM-0-7-centos ~]<span class="hljs-comment"># docker push registry.cn-hangzhou.aliyuncs.com/yz-zhouyinglin/resp:v1</span><br>The push refers <span class="hljs-keyword">to</span> repository [registry.cn-hangzhou.aliyuncs.com/yz-zhouyinglin/resp]<br>ffb151e67a73: Pushing [===========================================&gt;       ]  <span class="hljs-number">55.78</span>MB/<span class="hljs-number">64</span>MB<br><span class="hljs-number">23127db</span>07fa3: Pushing [========&gt;                                          ]  <span class="hljs-number">64.83</span>MB/<span class="hljs-number">384.4</span>MB<br>ffb151e67a73: Pushed<br><span class="hljs-number">23127db</span>07fa3: Pushing [==========&gt;                                        ]  <span class="hljs-number">77.64</span>MB/<span class="hljs-number">384.4</span>MB<br><span class="hljs-number">74ddd</span>0ec08fa: Pushing [=================&gt;                                 ]  <span class="hljs-number">78.85</span>MB/<span class="hljs-number">231.3</span>MB<br><span class="hljs-number">74ddd</span>0ec08fa: Pushing [===================&gt;                               ]  <span class="hljs-number">90.89</span>MB/<span class="hljs-number">231.3</span>MB<br></code></pre></td></tr></table></figure>

<p>push结束</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yaml">[<span class="hljs-string">root@VM-0-7-centos</span> <span class="hljs-string">~</span>]<span class="hljs-comment"># docker push registry.cn-hangzhou.aliyuncs.com/yz-zhouyinglin/resp:v1</span><br><span class="hljs-string">The</span> <span class="hljs-string">push</span> <span class="hljs-string">refers</span> <span class="hljs-string">to</span> <span class="hljs-string">repository</span> [<span class="hljs-string">registry.cn-hangzhou.aliyuncs.com/yz-zhouyinglin/resp</span>]<br><span class="hljs-attr">ffb151e67a73:</span> <span class="hljs-string">Pushing</span> [<span class="hljs-string">===========================================&gt;</span>       ]  <span class="hljs-number">55.</span><span class="hljs-string">78MB/64MB</span><br><span class="hljs-attr">23127db07fa3:</span> <span class="hljs-string">Pushing</span> [<span class="hljs-string">========&gt;</span>                                          ]  <span class="hljs-number">64.</span><span class="hljs-string">83MB/384.4MB</span><br><span class="hljs-attr">ffb151e67a73:</span> <span class="hljs-string">Pushed</span> <br><span class="hljs-attr">23127db07fa3:</span> <span class="hljs-string">Pushing</span> [<span class="hljs-string">==================================================&gt;</span>]  <span class="hljs-number">385.</span><span class="hljs-string">7MB</span><br><span class="hljs-attr">1e438b048a4f:</span> <span class="hljs-string">Pushed</span> <br><span class="hljs-attr">23127db07fa3:</span> <span class="hljs-string">Pushed</span> <br><span class="hljs-attr">v1: digest: sha256:a08b7a9ba95cb7cc624975f07d2fb4b686f316d1ae319cc557f2ce71291c7c26 size:</span> <span class="hljs-number">1373</span><br></code></pre></td></tr></table></figure>

<p>在阿里云的版本页面可以看到push 上来的镜像</p>
<p><img src="https://raw.githubusercontent.com/YuanZhou314/PicRepo/main/imgs/20220806201143.png" srcset="/img/loading.gif" lazyload></p>
<p>——————————————-Docker入门结束——————————————–</p>
<p><img src="https://raw.githubusercontent.com/YuanZhou314/PicRepo/main/imgs/20220806201204.png" srcset="/img/loading.gif" lazyload></p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Docker进阶-Dockerfile-镜像构建发布</div>
      <div>http://example.com/2022/08/06/Docker进阶-Dockerfile-镜像构建发布/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>周周</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2022年8月6日</div>
        </div>
      
      
      <div class="license-meta-item">
        <div>许可协议</div>
        <div>
          
            
            
              <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
              <span class="hint--top hint--rounded" aria-label="BY - 署名">
                <i class="iconfont icon-by"></i>
              </span>
              </a>
            
          
        </div>
      </div>
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2022/08/06/LeetCode-724-%E5%AF%BB%E6%89%BE%E6%95%B0%E7%BB%84%E7%9A%84%E4%B8%AD%E5%BF%83%E4%B8%8B%E6%A0%87/" title="LeetCode-724. 寻找数组的中心下标">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">LeetCode-724. 寻找数组的中心下标</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/08/06/unix%E3%80%81dos%E3%80%81mac%E6%96%87%E6%9C%AC%E6%A0%BC%E5%BC%8F%E5%8C%BA%E5%88%86/" title="unix、dos、mac文本格式区分">
                        <span class="hidden-mobile">unix、dos、mac文本格式区分</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  <article id="comments" lazyload>
    
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/valine/1.4.17/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"OTIyisgVldQtTwVk1kC3xG75-gzGzoHsz","appKey":"7oB3ndT9XSQ2jtgBMxNhwe9W","verify":false,"path":"window.location.pathname","placeholder":"说点什么吧","avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":false},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


  </article>


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
      <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> <div class="statistics" style="font-size: 0.85rem"> <a target="_blank" rel="noopener" href="https://developer.hitokoto.cn/" id="hitokoto_text"><span style="color: #3c4858;"  id="hitokoto"></span></a> <script src="https://v1.hitokoto.cn/?encode=js&select=%23hitokoto" defer></script></div>  <div style="font-size: 0.85rem"> <span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span> <script src="/js/duration.js"></script> <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>	 <span id="busuanzi_container_site_pv">,访问量<span id="busuanzi_value_site_pv"></span>次</span> </div>
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      headingSelector : CONFIG.toc.headingSelector || 'h1,h2,h3,h4,h5,h6',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      collapseDepth   : CONFIG.toc.collapseDepth || 0,
      scrollSmooth    : true,
      headingsOffset  : -boardTop
    });
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
