---
title: Python3.8-海象运算符
categories:
  - Dev
tags:
  - Python
abbrlink: d33b7b0c
date: 2023-04-19 10:32:49
index_img:
---

<!-- more -->
<!-- categories:Dev、Ops、Study、Sth、News、work-->
<!-- tags: 
Python、MySQL、LeetCode、机器学习、Linux、Big Data、Java、BlockChain、Docker、Web 、分布式、
Maven、数据结构、JVM、JavaScript、Crontab、Shell、Ubuntu、VPN、NodeJS、String、VM、Hadoop、
Life、树莓派、Git、Hexo、算法、运维、网络、看法、电影、美学、写作、哲学、文档、绘画、前端、
历史、政治、社会、导购
 -->
场景：假设某位顾客在果汁店点了一杯柠檬水，店员需要确保篮子里至少有一个柠檬来制作.

于是店员使用`if`语句查询是否为0：
```python
def make_lemonade(count):
    ...

def out_of_stock():
    ...

count = fresh_fruit.get('lemon', 0)
if count:
    make_lemonade(count)
else:
    out_of_stock()
```

这里的`count`在`if`前定义了一次，但它只在`if`的第一个代码块中使用到了，因此在`if`前定义显得有些多余，会分散对这个变量的注意力。现实中很多类似的情况，例如检查一个值并使用它。使用海象运算符可以简化这种情况：
```python

if count := fresh_fruit.get('lemon', 0):
    make_lemonade(count)
else:
    out_of_stock()
```
可以看到这里的`count`只跟`if`中的判断有关系，这样代码关系的清晰度就提高了。

上面是将整个海象运算符前后作为一个`boolean`类型来判断，而如果需要将它做运算比较，那么需要使用`()`将其包裹，例如：
```python
if (count := fresh_fruit.get('apple', 0)) >= 4:
```

还有一种情况是，频繁使用的`switch/case`语句，或多个`if-else`深度嵌套：
```python
count = fresh_fruit.get('banana', 0)
if count >= 2:
    pieces = slice_bananas(count)
    to_enjoy = make_smoothies(pieces)
else:
    count = fresh_fruit.get('apple', 0)
    if count >= 4:
        to_enjoy = make_cider(count)
    else:
        count = fresh_fruit.get('lemon', 0)
        if count:
            to_enjoy = make_lemonade(count)
        else:
            to_enjoy = 'Nothing'
```

海象运算符同样可以替代，作为优化版本：
```python
count = fresh_fruit.get('banana', 0)
if count >= 2:
    pieces = slice_bananas(count)
    to_enjoy = make_smoothies(pieces)
else:
    count = fresh_fruit.get('apple', 0)
    if count >= 4:
        to_enjoy = make_cider(count)
    else:
        count = fresh_fruit.get('lemon', 0)
        if count:
            to_enjoy = make_lemonade(count)
        else:
            to_enjoy = 'Nothing'
            
 ```

 “海象”运算符的语法形式为：NAME:= expr，NAME 是一个有效的标识符，而 expr 是一个有效的表达式。 因此，这意味着它不支持可迭代的打包和拆包。

当然海象运算符还有其他高阶用法（比如推导式），就不一一介绍了，反正估计也用不太上。只需要记住一点，碰到需要创建临时变量并判断时，就可以用海象运算符做优化代码的处理。
